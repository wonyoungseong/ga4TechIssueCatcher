# Story 4.2: Full-Page Screenshot Capture

## Status

Done

## Story

**As a** 디지털 애널리틱스 팀원,
**I want** 각 속성의 fullPage 스크린샷을 캡처하기를 원합니다,
**so that** 시각적 증거를 확보하고 문제 상황을 확인할 수 있습니다.

## Acceptance Criteria

1. 검증 후 Playwright의 `screenshot({ fullPage: true })`를 사용한다
2. 스크린샷 파일명에 속성명과 타임스탬프를 포함한다(`property-name_YYYYMMDD-HHmmss.png`)
3. 스크린샷은 날짜별 폴더에 저장된다(`screenshots/YYYY-MM-DD/`)
4. 스크린샷 캡처 실패 시 에러 로그를 기록하지만 검증은 계속 진행한다
5. 스크린샷 파일 크기가 10MB를 초과하면 경고 로그를 출력한다

## Tasks / Subtasks

- [ ] Implement screenshot capture (AC: 1)
  - [ ] Create `saveScreenshot()` function in `resultStorage` module
  - [ ] Use `page.screenshot({ fullPage: true, path: '...' })`
  - [ ] Return screenshot file path

- [ ] Implement filename generation (AC: 2)
  - [ ] Generate timestamp: `YYYYMMDD-HHmmss` format
  - [ ] Sanitize property name for filename
  - [ ] Combine: `property-name_timestamp.png`

- [ ] Implement folder structure (AC: 3)
  - [ ] Create date folder: `screenshots/YYYY-MM-DD/`
  - [ ] Use `fs.promises.mkdir` with `recursive: true`

- [ ] Add error handling (AC: 4, 5)
  - [ ] Wrap in try-catch
  - [ ] Log errors but return null
  - [ ] Check file size after capture
  - [ ] Warn if size > 10MB

## Dev Notes

**Module**: `resultStorage`
**Function**: `saveScreenshot(page, propertyName, date)`
**Playwright API**: `page.screenshot({ fullPage: true, path: '...' })`
**Filename Format**: `propertyName_YYYYMMDD-HHmmss.png`

**Implementation** (see Epic 4 for full code)

**Integration Points**:
- Called by: `orchestrator` after property validation
- Input: Playwright page object, property name
- Output: Screenshot file path or null

### Testing

**Test Location**: `test/modules/resultStorage.test.js`

**Testing Standards**:
- Test screenshot capture with correct filename
- Test date-based folder creation
- Test error handling for capture failures
- Test file size warning for large screenshots

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-29 | 1.0 | Initial story creation from Epic 4 | Sarah (PO) |
| 2025-01-29 | 1.1 | Story approved and ready for development | Sarah (PO) |

## Dev Agent Record

(To be filled by dev agent)

## QA Results

(To be filled by QA agent)
