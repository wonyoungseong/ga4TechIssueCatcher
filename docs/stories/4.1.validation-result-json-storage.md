# Story 4.1: Validation Result JSON Storage

## Status

Done

## Story

**As a** 디지털 애널리틱스 팀원,
**I want** 각 속성의 검증 결과를 JSON 형식으로 저장하기를 원합니다,
**so that** 히스토리를 추적하고 트러블슈팅할 수 있습니다.

## Acceptance Criteria

1. JSON 파일에 속성명, 검증 시간, 측정 ID 일치 여부를 저장한다
2. JSON 파일에 GTM ID 일치 여부, page_view 발생 여부를 저장한다
3. JSON 파일에 발견된 이슈 목록(배열)을 저장한다
4. JSON 파일에 스크린샷 파일 경로를 저장한다
5. JSON 파일은 날짜별 폴더에 저장된다(`results/YYYY-MM-DD/property-name.json`)
6. JSON은 읽기 쉽도록 들여쓰기(pretty print)된다

## Tasks / Subtasks

- [ ] Implement JSON result saving (AC: 1, 2, 3, 4)
  - [ ] Create `resultStorage` module
  - [ ] Create `saveValidationResult()` function
  - [ ] Accept ValidationResult object as input
  - [ ] Convert to JSON with `JSON.stringify(result, null, 2)`
  - [ ] Include all validation fields in JSON

- [ ] Implement date-based folder structure (AC: 5)
  - [ ] Generate folder path: `results/YYYY-MM-DD/`
  - [ ] Create folder if not exists (`fs.promises.mkdir` with `recursive: true`)
  - [ ] Generate filename from property name (sanitize special chars)
  - [ ] Write JSON file to folder

- [ ] Add error handling
  - [ ] Handle file write errors
  - [ ] Log errors but don't fail validation
  - [ ] Verify file was written successfully

## Dev Notes

**Module**: `resultStorage`
**Function**: `saveValidationResult(result, date)`
**Path Pattern**: `results/YYYY-MM-DD/property-name.json`
**JSON Format**: Pretty-printed with 2-space indentation

**JSON Structure** (see Epic 4 for full example)

**Integration Points**:
- Called by: `orchestrator` after each property validation
- Input: ValidationResult object
- Output: File path or null if failed

### Testing

**Test Location**: `test/modules/resultStorage.test.js`

**Testing Standards**:
- Test saving validation result as JSON
- Test date-based folder creation
- Test filename sanitization
- Test pretty-print formatting
- Test error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-29 | 1.0 | Initial story creation from Epic 4 | Sarah (PO) |
| 2025-01-29 | 1.1 | Story approved and ready for development | Sarah (PO) |

## Dev Agent Record

(To be filled by dev agent)

## QA Results

(To be filled by QA agent)
